<!DOCTYPE html>
<html lang="zh-Hans-CN" data-theme="light">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">


<title>网页明暗模式切换的原生代码 | 瓦尔登湖</title>


<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">


<link rel="stylesheet" href="/vendor/bootstrap-icons-1.11.3/font/bootstrap-icons.css">


<link href="/css/main.css" rel="stylesheet" type="text/css">
  </head>
  <body>
    <header id="header">
      <div class="header">
    <div class="title">瓦尔登湖</div>
    
    <div class="menu-main-toggle">
        <a class="open"><i class="bi bi-list"></i></a>
        <a class="close"><i class="bi bi-x"></i></a>
    </div>
</div>
<nav class="menu-main">
    <div class="menu-container">
        <ul class="menu">
    
    
        
        
        <li class="menu-item">
            <a class="" href="/zh/">首页</a>
        </li>
    
        
        
        <li class="menu-item">
            <a class="" href="/zh/blog/">博客</a>
        </li>
    
        
        
        <li class="menu-item">
            <a class=" active " href="/zh/docs/">笔记</a>
        </li>
    
    </ul>
    </div>
    
    <div class="menu-container">
        
    <ul class="menu">
    
    
            <li class="menu-item">
                <a href="http://localhost:1313/es/">Español</a>
            </li>
            
        
            <li class="menu-item">
                <a href="http://localhost:1313/">English</a>
            </li>
            
        
        
    
    
    </ul>

    </div>
</nav>
    </header>
    <div id="stager">
      
<aside class="aside-default">
    <div class="inner-container">
        <div id="menutree">
            


    
<ul class="menu-tree">

    

        <li class="menu-tree-title">
            <div class="container">
                <span>Ubuntu 操作系统</span>
                <a class="open"><i class="bi bi-chevron-down"></i></a>
                <a class="close"><i class="bi bi-chevron-up"></i></a>
            </div>
            
<ul class="menu-tree">

    
        <li class="menu-tree-item">
        
            <a href="http://localhost:1313/zh/docs/ubuntu/ubuntu-desktop/">Ubuntu 桌面的安装使用笔记</a>
        
        </li>
    

    
        <li class="menu-tree-item">
        
            <a href="http://localhost:1313/zh/docs/ubuntu/ubuntu-desktop-app/">Ubuntu 桌面 - 应用软件</a>
        
        </li>
    

    
        <li class="menu-tree-item">
        
            <a href="http://localhost:1313/zh/docs/ubuntu/ubuntu-desktop-tool/">Ubuntu 桌面 - 工具</a>
        
        </li>
    

</ul>

        </li>

    

    

        <li class="menu-tree-title">
            <div class="container">
                <span>Docker</span>
                <a class="open"><i class="bi bi-chevron-down"></i></a>
                <a class="close"><i class="bi bi-chevron-up"></i></a>
            </div>
            
<ul class="menu-tree">

    
        <li class="menu-tree-item">
        
            <a href="http://localhost:1313/zh/docs/docker/install-docker-on-ubuntu/">在 Ubuntu Server 上安装 Docker</a>
        
        </li>
    

    
        <li class="menu-tree-item">
        
            <a href="http://localhost:1313/zh/docs/docker/run-httpd-in-docker-as-webserver/">在 Docker 容器中运行 Apache 网站服务器</a>
        
        </li>
    

</ul>

        </li>

    

    

        <li class="menu-tree-title">
            <div class="container">
                <span>前端技术</span>
                <a class="open"><i class="bi bi-chevron-down"></i></a>
                <a class="close"><i class="bi bi-chevron-up"></i></a>
            </div>
            
<ul class="menu-tree">

    
        <li class="menu-tree-item">
        
            <a class="active" href="http://localhost:1313/zh/docs/frontend/light-and-dark-mode-switching/">网页明暗模式切换的原生代码</a>
        
        </li>
    

</ul>

        </li>

    

    

        <li class="menu-tree-title">
            <div class="container">
                <span>Nodejs</span>
                <a class="open"><i class="bi bi-chevron-down"></i></a>
                <a class="close"><i class="bi bi-chevron-up"></i></a>
            </div>
            
<ul class="menu-tree">

    
        <li class="menu-tree-item">
        
            <a href="http://localhost:1313/zh/docs/nodejs/nvm-nodejs-manager/">NVM - Nodejs 版本管理器</a>
        
        </li>
    

</ul>

        </li>

    

</ul>




    
        </div>
    </div>
</aside>
<main>
    <div id="docspost">
        <article class="docs-post">
    <div class="post-header">
        <h1 class="post-title">网页明暗模式切换的原生代码</h1>
        <div class="post-meta">
            <span>
                <i class="bi bi-calendar3"></i>
                Aug 31, 2022
            </span>
            <span>
                <i class="bi bi-person-circle"></i>
                
                    Homecat
                
            </span>
        </div>
    </div>
    <div class="post-container ">
        <div class="post-content markdown"><p>实现网页明暗模式的切换有多种方式，各有优缺点，可有个人喜好选择使用。本文记录通过 html、css 和 javascript 三种语言实现切换功能的基本思路和代码。</p>
<h2 id="基本思路">基本思路</h2>
<ul>
<li>定义明暗两种模式：分别为 light 和 dark；其中 dark 表示暗模式，并且作为默认模式。</li>
<li>在 <code>&lt;html&gt;</code> 元素内添加自定义属性 <code>data-theme</code>，当 <code>data-theme = dark</code> 时，页面渲染为暗模式；当 <code>data-theme = light</code> 时，渲染为明模式。</li>
<li>在 body 体内添加切换点，点击后触发切换。</li>
<li>在 css 的根元素 <code>:root</code> 里分别定义两种模式的属性。</li>
<li>在 javascript 中，添加切换点的监听和动作，用于改变 <code>data-theme</code> 的值。</li>
</ul>
<h2 id="实现">实现</h2>
<h3 id="html">HTML</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span> <span style="color:#a6e22e">data-theme</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;dark&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;modeToggle&#34;</span>&gt;Mode Toggle&lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">html</span>&gt;
</span></span></code></pre></div><h3 id="css">CSS</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-css" data-lang="css"><span style="display:flex;"><span>:<span style="color:#a6e22e">root</span><span style="color:#f92672">[</span><span style="color:#f92672">data-theme</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;light&#34;</span><span style="color:#f92672">]</span> {
</span></span><span style="display:flex;"><span>    --bg-base: <span style="color:#66d9ef">white</span>;
</span></span><span style="display:flex;"><span>    --ft-base: <span style="color:#66d9ef">black</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>:<span style="color:#a6e22e">root</span><span style="color:#f92672">[</span><span style="color:#f92672">data-theme</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;dark&#34;</span><span style="color:#f92672">]</span> {
</span></span><span style="display:flex;"><span>    --bg-base: <span style="color:#66d9ef">black</span>;
</span></span><span style="display:flex;"><span>    --ft-base: <span style="color:#66d9ef">white</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">body</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">background-color</span>: <span style="color:#a6e22e">var</span>(<span style="color:#f92672">--</span>bg<span style="color:#f92672">-</span>base);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">color</span>: <span style="color:#a6e22e">var</span>(<span style="color:#f92672">--</span>ft<span style="color:#f92672">-</span>base);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="javascript">JAVASCRIPT</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">modeToggle</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#34;modeToggle&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">modeToggle</span>.<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#34;click&#34;</span>,()=&gt;{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">currentMode</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">documentElement</span>.<span style="color:#a6e22e">getAttribute</span>(<span style="color:#e6db74">&#34;data-theme&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">targetMode</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">currentMode</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#34;light&#34;</span> <span style="color:#f92672">?</span> <span style="color:#e6db74">&#34;dark&#34;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;light&#34;</span>;
</span></span><span style="display:flex;"><span>    document.<span style="color:#a6e22e">documentElement</span>.<span style="color:#a6e22e">setAttribute</span>(<span style="color:#e6db74">&#34;data-theme&#34;</span>,<span style="color:#a6e22e">targetMode</span>);
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><h2 id="优化">优化</h2>
<p>通过上述实践，实现了页面明暗模式的切换，但是只适用于单页面网站。当页面跳转时，页面会重新渲染，切换后的模式不会带入到新的网页中；使用 Web API 接口对象 Window.sessionStorage 对 javascript 文件进行优化。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">sessionStorage</span>.<span style="color:#a6e22e">getItem</span>(<span style="color:#e6db74">&#39;mode&#39;</span>)) { 
</span></span><span style="display:flex;"><span>    document.<span style="color:#a6e22e">documentElement</span>.<span style="color:#a6e22e">setAttribute</span>(<span style="color:#e6db74">&#34;data-theme&#34;</span>,<span style="color:#a6e22e">sessionStorage</span>.<span style="color:#a6e22e">getItem</span>(<span style="color:#e6db74">&#39;mode&#39;</span>));
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">modeToggle</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#34;modeToggle&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">modeToggle</span>.<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#34;click&#34;</span>,()=&gt;{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">currentMode</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">documentElement</span>.<span style="color:#a6e22e">getAttribute</span>(<span style="color:#e6db74">&#34;data-theme&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">targetMode</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">currentMode</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#34;light&#34;</span> <span style="color:#f92672">?</span> <span style="color:#e6db74">&#34;dark&#34;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;light&#34;</span>;
</span></span><span style="display:flex;"><span>    document.<span style="color:#a6e22e">documentElement</span>.<span style="color:#a6e22e">setAttribute</span>(<span style="color:#e6db74">&#34;data-theme&#34;</span>,<span style="color:#a6e22e">targetMode</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">sessionStorage</span>.<span style="color:#a6e22e">setItem</span>(<span style="color:#e6db74">&#34;mode&#34;</span>,<span style="color:#a6e22e">targetMode</span>);
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><h2 id="进一步优化">进一步优化</h2>
<p>优化后，切换后的明暗模式被带入到新的页面，但是还存在一个问题：每次页面跳转时，会出现一次跳闪。这是因为页面刷新时，先渲染默认的明暗模式，然后再改变为需要的明暗模式。</p>
<p>解决的方法是将 javascript 文件中，判断明暗模式的语句，转移到 <code>&lt;head&gt;</code> 元素里。这样就可以在渲染页面之前就修改参数，直接渲染为需要的明暗模式。</p>
<h3 id="html-1">HTML</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span> <span style="color:#a6e22e">data-theme</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;dark&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">sessionStorage</span>.<span style="color:#a6e22e">getItem</span>(<span style="color:#e6db74">&#39;mode&#39;</span>)) { 
</span></span><span style="display:flex;"><span>                document.<span style="color:#a6e22e">documentElement</span>.<span style="color:#a6e22e">setAttribute</span>(<span style="color:#e6db74">&#34;data-theme&#34;</span>,<span style="color:#a6e22e">sessionStorage</span>.<span style="color:#a6e22e">getItem</span>(<span style="color:#e6db74">&#39;mode&#39;</span>));
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;modeToggle&#34;</span>&gt;Mode Toggle&lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">html</span>&gt;
</span></span></code></pre></div><h3 id="javascript-1">JAVASCRIPT</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">modeToggle</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#34;modeToggle&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">modeToggle</span>.<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#34;click&#34;</span>,()=&gt;{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">currentMode</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">documentElement</span>.<span style="color:#a6e22e">getAttribute</span>(<span style="color:#e6db74">&#34;data-theme&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">targetMode</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">currentMode</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#34;light&#34;</span> <span style="color:#f92672">?</span> <span style="color:#e6db74">&#34;dark&#34;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;light&#34;</span>;
</span></span><span style="display:flex;"><span>    document.<span style="color:#a6e22e">documentElement</span>.<span style="color:#a6e22e">setAttribute</span>(<span style="color:#e6db74">&#34;data-theme&#34;</span>,<span style="color:#a6e22e">targetMode</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">sessionStorage</span>.<span style="color:#a6e22e">setItem</span>(<span style="color:#e6db74">&#34;mode&#34;</span>,<span style="color:#a6e22e">targetMode</span>);
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><h2 id="参考">参考</h2>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Global_attributes/data-*">html自定义属性 data-*</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/:root">css伪类 :root</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/var">css函数 var()</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/sessionStorage">javascript接口 Window.sessionStorage</a></li>
</ul></div>
        <div class="post-toc"><nav id="TableOfContents">
  <ul>
    <li><a href="#基本思路">基本思路</a></li>
    <li><a href="#实现">实现</a>
      <ul>
        <li><a href="#html">HTML</a></li>
        <li><a href="#css">CSS</a></li>
        <li><a href="#javascript">JAVASCRIPT</a></li>
      </ul>
    </li>
    <li><a href="#优化">优化</a></li>
    <li><a href="#进一步优化">进一步优化</a>
      <ul>
        <li><a href="#html-1">HTML</a></li>
        <li><a href="#javascript-1">JAVASCRIPT</a></li>
      </ul>
    </li>
    <li><a href="#参考">参考</a></li>
  </ul>
</nav></div>
    </div>
</article>

    </div>
</main>
<div class="toggles">
    <a class="sider-open"><i class="bi bi-layout-sidebar"></i></a>
    <a class="sider-close"><i class="bi bi-x"></i></a>
    <a class="totop" href="#"><i class="bi bi-chevron-up"></i></a>
    <a href="#TableOfContents"><i class="bi bi-list-ul"></i></a>
</div>

    </div>
    <footer id="footer">
      <div class="copyright">
    <span><i class="bi bi-c-circle"></i>2025</span>
    <span>Homecat</span>
    <span>版权所有</span>
</div>
    </footer>
  
<script src="/vendor/jquery-3.7.1/jquery.min.js"></script>


<script src="/js/main.js"></script>
  </body>
</html>
